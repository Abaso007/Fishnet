<style>
.header__left>img {
  height: 40px;
}

.header__items {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
  cursor: pointer;
  width: 40px;
  height: 40px;
  background-color: #e4e6eb;
  border-radius: 50%;
  transition: background-color 0.2s ease-in-out;
  transition-timing-function: cubic-bezier(0, 0, 1, 1);
}

.header__center {
  display: flex;
  flex-direction: row;
  justify-content: center;
}

.header__option {
  display: flex;
  align-items: center;
  cursor: pointer;
  position: relative;
  height: auto;
  min-height: 62px;
}

.header__right {
  display: flex;
}

.header__info {
  display: flex;
  align-items: center;
  padding-right: 12px;
}

.header__info>span {
  margin-left: 10px;
}

.header__option:hover {
  background-color: #f0f2f5;
  border-top-left-radius: 1px;
  border-top-right-radius: 1px;
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}

.header__option.active,
.header__option:hover {
  color: #1877f2;
  box-shadow: inset 0 -3px #1877f2;
  /* border-bottom: 1px solid #1877f2; */
  border-bottom-width: 3px;
  background-color: #f8f9fa;
}
</style>

{% if request.user.is_authenticated %}
<div class="container-fluid">
    {% if project %}
    <div class="topbar-nav ml-md-auto">
        <div class="header__center">
            <div class="nav-item hidden-caret header__option {% if 'network' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('network');" href="#" role="button">
                    <i class="fa fa-wifi mr-2"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item hidden-caret header__option {% if 'topology' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('topology');" href="#" role="button">
                    <i class="fa fa-sitemap mr-2"></i>
                    <span class="{% if hosts %}mr-2{% endif %}">Topology</span>
                    {% if hosts %}
                    <span class="badge badge-success">{{ hosts | length }}</span>
                    {% endif %}
                </a>
            </div>
            <div class="nav-item hidden-caret header__option {% if 'services' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('services');" href="#" role="button">
                    <i class="fa fa-eye mr-2"></i>
                    <span class="{% if services.0 %}mr-2{% endif %}">Services</span>
                    {% if services.0 %}
                    <span class="badge badge-success">{{ services.0 | length }}</span>
                    {% endif %}
                </a>
            </div>
            <div class="nav-item hidden-caret header__option {% if 'flaws' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('flaws');" href="#" role="button">
                    <i class="fa fa-lock-open mr-2"></i>
                    <span class="{% if flaws %}mr-2{% endif %}">Flaws</span>
                    {% if flaws %}
                    <span class="badge badge-danger">{{ flaws | length }}</span>
                    {% endif %}
                </a>
            </div>
            <div class="nav-item hidden-caret header__option {% if 'attack' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('attack');" href="#" role="button">
                    <i class="fa fa-bomb mr-2"></i>
                    <span>Attack</span>
                </a>
            </div>
            <div class="nav-item hidden-caret header__option {% if 'sessions' in segment %}active{% endif %}">
                <a aria-expanded="false" aria-haspopup="true" class="btn"
                    onclick="updateContext('sessions');" href="#" role="button">
                    <i class="fa fa-user mr-2"></i>
                    <span class="{% if sessions %}mr-2{% endif %}">Sessions</span>
                    {% if sessions %}
                    <span class="badge badge-success">{{ sessions | length }}</span>
                    {% endif %}
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
        {% if not project %}
        <li class="nav-item dropdown hidden-caret">
            <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown"
               href="#" id="messageDropdown" role="button">
                <i class="fa fa-bell"></i>
            </a>
            <ul aria-labelledby="messageDropdown" class="dropdown-menu messages-notif-box animated fadeIn">
                <li>
                    <div class="dropdown-title d-flex justify-content-between align-items-center">
                        Messages
                    </div>
                </li>
                <li>
                    <div class="message-notif-scroll scrollbar-outer">
                        <div class="notif-center">
                            <a href="#">
                                <div class="notif-img">
                                    <img draggable="false" alt="Img Profile" src="/static/assets/img/icon.png">
                                </div>
                                <div class="notif-content">
                                    <span class="subject">Fishnet</span>
                                    <span class="block">Hotline Miami is the best game in the world!</span>
                                    <span class="time">success</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
            </ul>
        </li>
        <li class="nav-item dropdown hidden-caret">
            <a aria-expanded="false" class="nav-link" data-toggle="dropdown" href="#">
                <i class="fas fa-layer-group"></i>
            </a>
            <div class="dropdown-menu quick-actions quick-actions-info animated fadeIn">
                <div class="quick-actions-header">
                    <span class="title mb-1">Quick actions</span>
                    <span class="subtitle op-8">Some quick actions</span>
                </div>
                <div class="quick-actions-scroll scrollbar-outer">
                    <div class="quick-actions-items">
                        <div class="row m-0">
                            <a class="col-6 col-md-4 p-0" href="#">
                                <div class="quick-actions-item">
                                    <form method="post">
                                        {% csrf_token %}
                                        <button class="btn btn-link" data-toggle="tooltip"
                                                name="toggle_dark"
                                                title="" type="submit" value="{% if dark_mode %} 0 {% else %} 1 {% endif %}">
                                            {% if dark_mode %}
                                            <i class="fas fa-sun"></i>
                                            {% else %}
                                            <i class="fas fa-moon"></i>
                                            {% endif %}
                                        </button>
                                    </form>
                                </div>
                            </a>
                            <a class="col-6 col-md-4 p-0" href="#">
                                <div class="quick-actions-item">
                                    <button class="btn btn-link" data-target="#showTeam" data-toggle="modal">
                                        <i class="fas fa-user"></i>
                                    </button>
                                </div>
                            </a>
                            <a class="col-6 col-md-4 p-0" href="#">
                                <div class="quick-actions-item">
                                    <button class="btn btn-link" data-target="#addTeam" data-toggle="modal">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </li>
        {% else %}
        <li class="nav-item dropdown hidden-caret">
            <a aria-expanded="false" aria-haspopup="true" class="nav-link"
               href="/projects" role="button">
                <i class="fa fa-eject"></i>
            </a>
        </li>
        <li class="nav-item dropdown hidden-caret">
            <a aria-expanded="false" aria-haspopup="true" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown"
               href="#" id="projectDropdown" role="button">
                <i class="fa fa-box mr-2"></i>
                <span>{{ project.name }}</span>
            </a>
            <ul aria-labelledby="projectDropdown" class="dropdown-menu messages-notif-box animated fadeIn">
                <li>
                    <div class="dropdown-title d-flex justify-content-center align-items-center">
                        {{ project.name }}
                    </div>
                </li>
                <li>
                    <div class="message-notif-scroll scrollbar-outer">
                        <div class="notif-center">
                            <a class="justify-content-center">
                                <div class="notif-content">
                                    <button class="btn btn-success btn-sm" data-target="#selectScanner" data-toggle="modal">
                                        <i class="fas fa-rocket mr-2"></i>
                                        <span>Execute</span>
                                    </button>
                                </div>
                            </a>
                            <a class="justify-content-center">
                                <div class="notif-content">
                                    <form id="projectForm" method="post">
                                        {% csrf_token %}
                                        <button name="project_stop" type="submit" class="btn" onclick="updateContext('{{ segment }}');">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                        {% if request.user.username == project.author %}
                                        <button name="project_archive" type="submit" class="btn" onclick="clearIntervals(); location.href = '/projects';">
                                            <i class="fas fa-archive"></i>
                                        </button>
                                        {% endif %}
                                    </form>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
            </ul>
        </li>
        {% endif %}
        <li class="nav-item dropdown hidden-caret">
            <a aria-expanded="false" class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#">
                <div class="avatar-sm">
                    <img draggable="false" alt="..." class="avatar-img rounded-circle" src="/static/assets/img/icon.png">
                </div>
            </a>
            <ul class="dropdown-menu dropdown-user animated fadeIn">
                <li>
                    <div class="user-box">
                        <div class="avatar-lg"><img draggable="false" alt="image profile" class="avatar-img rounded"
                                                    src="/static/assets/img/icon.png"></div>
                            <div class="u-text">
                                <h4>
                                    {% if request.user.first_name or request.user.last_name %}
                                    {% if request.user.first_name %}
                                    {{ request.user.first_name }}
                                    {% endif %}
                                    {% if request.user.last_name %}
                                    {{ request.user.last_name }}
                                    {% endif %}
                                    {% else %}
                                    {{ request.user.username }}
                                    {% endif %}
                                </h4>
                                <p class="text-muted">
                                    {{ request.user.username }}
                                </p>
                                <a class="btn btn-xs btn-primary btn-sm" data-target="#showProfile" data-toggle="modal"
                                   href="#">View Profile</a>
                            </div>
                    </div>
                </li>
                <li>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                </li>
            </ul>
        </li>
    </ul>
</div>
{% endif %}

<script>
    function updateContext(segment) {
        clearIntervals();
        $('#content').html('');

        if (segment.length == 0) {
            segment = '{{ segment }}'
        }

        {% if project.running %}
        startIntervals(segment);
        {% else %}
        updateNavigation('{{ request.path }}', segment, '{{ project.uuid }}', false);
        updateContent('{{ request.path }}', segment, '{{ project.uuid }}', false);
        {% endif %}
    }
</script>